# 塔防项目初始对话与需求汇总（2025-08-20）

本文档整理当前对话内容，归纳项目的已确定需求、范围界定与开放问题，作为后续迭代的统一依据。

## 基本信息
- Unity 版本：2021.3.1f1c1
- 渲染管线：Built-in（内置管线）
- 项目类型：3D
- 目标平台：
  - 当前：PC（横屏）
  - 未来：Android（横屏）
- 性能目标：≥ 60 FPS
- UI 框架：UGUI
- 输入：暂不做特定要求（按需）
- 测试 / CI：暂不考虑
- 多语言 / 存档：暂不考虑

## 核心玩法与世界
- 地图与布局：可考虑基于方块网格（格子大小不固定）。
- 敌人移动：暂不做通用寻路；敌方沿预设路径（Path）行进。
- 建造：玩家在路径上搭建防御塔来攻击敌人。
- 首发塔：3 个塔型。
- 攻击形态：初期统一为“子弹型投射物”，后续可拓展（射线、范围、光束等）。
- 元素体系：金木水火土；示例克制关系为“金克木，木克水，…，土克金”。
- 关卡：固定关卡（暂不做关卡编辑器）。
- 资源：暂无美术资源，初期用 Unity 内置 3D Primitive 占位。
- 资源管理：使用对象池（Pooling）。

## 数据与配置
- 配置载体：不使用 ScriptableObject，统一使用 JSON。
  - 涵盖：塔、敌人、关卡、元素伤害/抗性、平衡参数等。

## 代码与架构约定（后续将补充到 CodingStandards.md）
- GameObject 只承载生命周期函数与最薄逻辑；核心逻辑在纯 C# 类中实现。
- 使用接口与多态，必要时通过 partial 将大类拆分为多个文件。
- 公共与通用函数沉淀到 Common/Utilities 目录。
- 每个类保持简洁，并附带 XML 注释与对应的 .md 说明文件（按需）。
- 目录建议（待创建）：
  - Assets/Scripts
    - Common（对象池、计时器、事件、服务容器、接口）
    - Core（启动、生命周期驱动、场景装配）
    - Gameplay（塔/敌人/投射物/路径/波次/伤害/目标选择）
    - UI（HUD、建造、通用界面）
    - Config（JSON 读写与数据模型）
  - Assets/Docs（规范、进度、架构、类说明）

## 待明确 / 开放问题
- 网格与建造：
  - 格子单位大小由程序统一定义，支持在关卡层配置；不允许阻断路径；塔放置为路径周围离散格位。
- 路径表达：采用折线 Waypoints；路径数据由关卡 JSON 定义。
- 元素克制：采用完整环（金→木→水→火→土→金）；克制系数：克制1.25，被克0.8；其余为1.0。伤害公式细节后续在 Specs 定稿。
- 敌人波次：固定关卡的波次 JSON 字段需要现在定稿（将在 Specs 提案）。
- JSON 管理：放置于 StreamingAssets，需支持运行时加载；是否热更新与加密暂不考虑。

## 近期建议的最小实现（仅供排期参考）
1) 文档与规范：创建 Docs 目录与 CodingStandards.md、Progress.md 骨架。
2) 核心框架：
   - GameBootstrapper（MonoBehaviour，最薄生命周期）
   - ServiceContainer（服务定位/轻量 DI）
   - UpdateDriver（集中驱动 IUpdatable/ILateUpdatable/IFixedUpdatable）
3) 通用：
   - 对象池（泛型池 + 预热）
   - JSON 序列化工具（Newtonsoft 或 Unity 内置 JsonUtility + 自定义扩展）
4) Gameplay 初版：
   - Path/Waypoint 数据结构与简单路径跟随组件
   - 塔基放置规则（基于路径的离散点或格位）
   - 敌人简易移动与生命/伤害接口
   - 子弹型投射物（命中回收，对象池管理）
   - 简易元素克制系数表与伤害计算

## 本次对话结论
- 以本文档为当前唯一“需求真相来源”。
- 坐标系：关卡内坐标以关卡原点为参考，单位为米。
- 可视化：关卡需提供网格可视化对齐（gizmos 控制）。
- 路径：支持多路径（paths），刷怪组可绑定 pathId。
- 建造点：采用离散格位，新增 `type` 字段区分不同建造点类型；不允许阻断路径。
- 波次：每波设置 `reward` 清算奖励；不做连击奖励。
- JSON：配置放置于 StreamingAssets，先不考虑热更新/加密。
- 下一步：先完善 JSON 规格（路径/关卡/元素/塔/敌人/波次），待确认后再开始最小核心框架实现。

---
文档维护者：项目客户端负责人
更新时间：2025-08-20
